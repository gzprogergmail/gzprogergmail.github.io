<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Photo and Ruler Interface</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    touch-action: none;
  }
  #container {
    position: relative;
    width: 100%;
    height: 100vh;
  }
  #photo {
    position: absolute;
    left: 0;
    width: 50%;
    height: 100%;
    object-fit: contain;
    background-color: #f0f0f0;
  }
  #rulerContainer {
    position: absolute;
    right: 0;
    width: 50%;
    height: 100%;
    touch-action: none;
  }
  #ruler {
    position: absolute;
    left: 25%;
    top: 0;
    width: 50px;
    height: 100%;
    background: linear-gradient(to top, #fff 0%, #fff 100%);
    border-left: 1px solid #000;
    border-right: 1px solid #000;
    touch-action: none;
  }
  .mark {
    position: absolute;
    left: 0;
    width: 100%;
    height: 1px;
    background: #000;
  }
  .smallMark {
    width: 10px;
  }
  .bigMark {
    width: 20px;
  }
  .label {
    position: absolute;
    left: 25px;
    font-size: 12px;
  }
  #slider {
    position: absolute;
    left: -25%;
    width: 150%;
    height: 30px;
    background: rgba(0, 0, 255, 0.3);
    touch-action: none;
  }
  #sliderLine {
    position: absolute;
    left: 25%;
    width: 50%;
    height: 1px;
    top: 50%;
    background: #000;
  }
  .grip {
    position: absolute;
    left: -25%;
    width: 150%;
    height: 30px;
    background: rgba(255, 0, 0, 0.3);
    touch-action: none;
  }
  #topGrip {
    top: 0;
  }
  #bottomGrip {
    bottom: 0;
  }
  .gripLine {
    position: absolute;
    left: 25%;
    width: 50%;
    height: 1px;
    background: #000;
    top: 50%;
  }
</style>
</head>
<body>

<div id="container">
  <input type="file" id="upload" accept="image/*" style="position:absolute; z-index:10;">
  <img id="photo" src="" alt="Uploaded Photo">
  <div id="rulerContainer">
    <div id="ruler">
      <!-- Marks and labels will be generated by JavaScript -->
    </div>
    <div id="slider">
      <div id="sliderLine"></div>
    </div>
    <div id="topGrip" class="grip">
      <div class="gripLine"></div>
    </div>
    <div id="bottomGrip" class="grip">
      <div class="gripLine"></div>
    </div>
  </div>
</div>

<script>
  // Handle Photo Upload
  const uploadInput = document.getElementById('upload');
  const photo = document.getElementById('photo');

  uploadInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) {
      photo.src = URL.createObjectURL(file);
    }
  });

  // Generate Ruler Marks and Labels
  const ruler = document.getElementById('ruler');
  let rulerHeight = ruler.clientHeight;
  const totalUnits = 100;
  let unitHeight = rulerHeight / totalUnits;

  function generateMarks() {
    // Remove existing marks and labels
    while (ruler.firstChild) {
      ruler.removeChild(ruler.firstChild);
    }
    for (let i = 0; i <= totalUnits; i++) {
      const mark = document.createElement('div');
      mark.classList.add('mark');
      mark.style.top = `${rulerHeight - i * unitHeight - 1}px`;

      if (i % 10 === 0) {
        mark.classList.add('bigMark');
        const label = document.createElement('div');
        label.classList.add('label');
        label.style.top = `${rulerHeight - i * unitHeight - 8}px`;
        label.innerText = i;
        ruler.appendChild(label);
      } else {
        mark.classList.add('smallMark');
      }
      ruler.appendChild(mark);
    }
  }

  generateMarks();

  // Touch Interactions
  let rulerOffsetY = 0;
  let sliderOffsetY = 0;
  let scaleStartTop = 0;
  let scaleStartBottom = 0;

  // Move Ruler
  ruler.addEventListener('touchstart', startRulerMove);
  ruler.addEventListener('touchmove', moveRuler);

  function startRulerMove(e) {
    e.preventDefault();
    rulerOffsetY = e.touches[0].clientY - ruler.offsetTop;
  }

  function moveRuler(e) {
    e.preventDefault();
    const y = e.touches[0].clientY - rulerOffsetY;
    ruler.style.top = `${y}px`;
  }

  // Slider Movement
  const slider = document.getElementById('slider');
  slider.addEventListener('touchstart', startSliderMove);
  slider.addEventListener('touchmove', moveSlider);

  function startSliderMove(e) {
    e.preventDefault();
    sliderOffsetY = e.touches[0].clientY - slider.offsetTop;
  }

  function moveSlider(e) {
    e.preventDefault();
    let y = e.touches[0].clientY - sliderOffsetY;
    // Constrain slider within ruler bounds
    const minY = 0;
    const maxY = ruler.clientHeight - slider.clientHeight;
    y = Math.max(minY, Math.min(maxY, y));
    slider.style.top = `${y}px`;
  }

  // Grips for Scaling
  const topGrip = document.getElementById('topGrip');
  const bottomGrip = document.getElementById('bottomGrip');

  topGrip.addEventListener('touchstart', startScaleTop);
  topGrip.addEventListener('touchmove', scaleTop);

  bottomGrip.addEventListener('touchstart', startScaleBottom);
  bottomGrip.addEventListener('touchmove', scaleBottom);

  function startScaleTop(e) {
    e.preventDefault();
    scaleStartTop = e.touches[0].clientY;
  }

  function scaleTop(e) {
    e.preventDefault();
    const delta = e.touches[0].clientY - scaleStartTop;
    const newHeight = ruler.clientHeight - delta;
    const newTop = ruler.offsetTop + delta;
    if (newHeight > 50 && newTop >= 0) {
      ruler.style.height = `${newHeight}px`;
      ruler.style.top = `${newTop}px`;
      rulerHeight = newHeight;
      unitHeight = rulerHeight / totalUnits;
      generateMarks();
      scaleStartTop = e.touches[0].clientY;
    }
  }

  function startScaleBottom(e) {
    e.preventDefault();
    scaleStartBottom = e.touches[0].clientY;
  }

  function scaleBottom(e) {
    e.preventDefault();
    const delta = e.touches[0].clientY - scaleStartBottom;
    const newHeight = ruler.clientHeight + delta;
    if (newHeight > 50 && (ruler.offsetTop + newHeight) <= ruler.parentElement.clientHeight) {
      ruler.style.height = `${newHeight}px`;
      rulerHeight = newHeight;
      unitHeight = rulerHeight / totalUnits;
      generateMarks();
      scaleStartBottom = e.touches[0].clientY;
    }
  }
</script>

</body>
</html>
